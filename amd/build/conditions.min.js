define(["jquery"],function(i){var e=function(e){var t=i("#fitem_id_profile_field_"+e);return 0===t.length&&(t=i(".fitem [name=profile_field_"+e+"], .fitem [name^=profile_field_"+e+"\\[]").closest(".fitem.row")),t},t=function(e,t,n,l){this.fieldName=e,this.conditions=i.parseJSON(t);var o=[];this.conditions.forEach(function(e){e.hiddenfields.forEach(function(e){-1==i.inArray(e,o)&&o.push(e)}),e.requiredfields.forEach(function(e){-1==i.inArray(e,o)&&o.push(e)})}),this.allElements=o,this.hiddenElements={},this.hideAll=1==n,this.reqHTML=l,this.initApplyRule(),i("#id_profile_field_"+e).change(this.applyRule.bind(this)).closest("form").submit(this.beforeSubmit.bind(this))};return t.prototype.fieldName=null,t.prototype.conditions=null,t.prototype.allElements=null,t.prototype.hiddenElements=null,t.prototype.hideAll=null,t.prototype.options=null,t.prototype.beforeSubmit=function(i){var t;if(!i.isDefaultPrevented())for(var n in this.hiddenElements)this.hiddenElements.hasOwnProperty(n)&&""!=(t=e(n).html())&&(this.hiddenElements[n]=t,e(n).html(""))},t.prototype.initReqStars=function(){var i=[],t=[];this.allElements.forEach(function(t){0===e(t).find(".fitemtitle .fa-exclamation-circle").length&&0===e(t).find("abbr.text-danger").length||i.push(t)}),this.hideAll&&this.conditions.forEach(function(i){i.hiddenfields.forEach(function(i){t.push(i)})}),this.conditions.push({option:"",hiddenfields:t,requiredfields:i})},t.prototype.toggleReqStars=function(){var t,n,l,o=i("#id_profile_field_"+this.fieldName).val(),h=this.reqHTML,r=this.allElements,d=null;this.conditions.forEach(function(s){s.option==o&&(t=s.requiredfields,r.forEach(function(o){n=e(o),null===d&&(d=n.has(".float-sm-right").length),-1!=i.inArray(o,t)?(d&&0!==(l=n.find("abbr.text-danger")).length?h=l.html():l=n.find(".fa-exclamation-circle"),0===l.length&&(l=i(h).hide(),d?n.find(".float-sm-right").append(l):n.find(".fitemtitle label").append(l)),l.show("slow")):(n.find("abbr.text-danger").hide("slow",function(){-1!=i.inArray(o,t)&&e(o).find("abbr.text-danger").remove()}),n.find(".req").hide("slow",function(){-1!=i.inArray(o,t)&&e(o).find(".fa-exclamation-circle").remove()}))}))}),this.reqHTML=h},t.prototype.applyRule=function(){var t=this.hiddenElements,n=i("#id_profile_field_"+this.fieldName).val(),l=this.hideAll,o=null;this.conditions.forEach(function(h){if(""===n)if(l)h.hiddenfields.forEach(function(i){i in t||(t[i]="",e(i).children().hide("slow"))});else for(o in t)t.hasOwnProperty(o)&&(t[o]&&e(o).html(t[o]),e(o).children().show("slow"),delete t[o]);if(h.option==n){for(o in t)t.hasOwnProperty(o)&&-1==i.inArray(o,h.hiddenfields)&&(t[o]&&e(o).html(t[o]),e(o).children().show("slow"),delete t[o]);h.hiddenfields.forEach(function(i){i in t||(t[i]="",e(i).children().hide("slow"))})}}),this.hiddenElements=t,this.toggleReqStars()},t.prototype.initApplyRule=function(){var i=this.hiddenElements;this.hideAll&&this.conditions.forEach(function(t){t.hiddenfields.forEach(function(t){t in i||(i[t]="",e(t).children().hide())})}),this.hiddenElements=i,this.initReqStars(),this.applyRule()},{apply:function(i,e,n,l){return new t(i,e,n,l)}}});
